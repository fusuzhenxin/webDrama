{"ast":null,"code":"import { ref, onMounted, onUnmounted } from 'vue';\nimport request from \"@/utils/request\";\nimport { useRoute } from 'vue-router';\nexport default {\n  __name: 'VideoDetail',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const videoData = ref(null);\n    const videoPlayer = ref(null);\n    const numberOfEpisodes = ref(0);\n    const videoCanvas = ref(null);\n    let canvasContext = null;\n    const route = useRoute();\n    const videoId = route.params.id;\n    const videoName = route.params.name;\n    const loadVideoData = async () => {\n      try {\n        const res = await request.get(`/file/${videoId}`);\n        videoData.value = res.data.data;\n      } catch (error) {\n        console.error('Error loading video data:', error);\n      }\n    };\n    const loadNumberOfEpisodes = async () => {\n      try {\n        const res = await request.get('/videos/diversity', {\n          params: {\n            name: videoName\n          }\n        });\n        numberOfEpisodes.value = res.data.data;\n      } catch (error) {\n        console.error('Error loading number of episodes:', error);\n      }\n    };\n    onMounted(() => {\n      loadVideoData();\n      loadNumberOfEpisodes();\n      setTimeout(initializeCanvas, 0); // 延迟执行 initializeCanvas 方法\n    });\n    const initializeCanvas = () => {\n      videoCanvas.value = ref(document.querySelector('.video-canvas')); // 使用 ref 函数获取元素引用\n      console.log(\"videoCanvas.value\", videoCanvas.value);\n      if (!videoCanvas.value.value) return; // 检查是否获取到了 canvas 元素\n      canvasContext = videoCanvas.value.value.getContext('2d'); // 使用 .value 来访问引用的值\n    };\n    const loadEpisode = async episodeNumber => {\n      try {\n        const res = await request.get(`/videos/${videoName}/episode/${episodeNumber}`);\n        const url = res.data.data;\n        if (videoPlayer.value) {\n          videoPlayer.value.src = url;\n          videoPlayer.value.load();\n        }\n      } catch (error) {\n        console.error('Error loading episode:', error);\n      }\n    };\n    const handleVideoLoaded = () => {\n      if (videoPlayer.value) {\n        videoPlayer.value.play();\n      }\n    };\n    const renderVideoFrameToCanvas = () => {\n      if (!videoPlayer.value || !canvasContext || videoPlayer.value.paused || videoPlayer.value.ended) return; // 添加条件以避免错误\n      canvasContext.clearRect(0, 0, videoCanvas.value.width, videoCanvas.value.height); // 清除画布\n\n      console.log(\"videoCanvas.value.width====\", videoCanvas.value.width);\n      canvasContext.drawImage(videoPlayer.value, 0, 0, videoCanvas.value.width, videoCanvas.value.height);\n      applyBlurEffect();\n    };\n    const applyBlurEffect = () => {\n      if (!canvasContext) return; // 提前返回以避免错误\n      canvasContext.filter = 'blur(10px)'; // 应用模糊效果\n    };\n\n    // 监听视频播放事件，确保在视频播放时渲染视频帧到 Canvas\n    const handleVideoPlay = () => {\n      requestAnimationFrame(renderVideoFrameToCanvas); // 使用 requestAnimationFrame 代替 setInterval，以优化性能\n    };\n\n    // 监听视频播放事件\n    onMounted(() => {\n      if (videoPlayer.value) {\n        videoPlayer.value.addEventListener('play', handleVideoPlay);\n      }\n    });\n\n    // 在组件销毁时移除事件监听器\n    onUnmounted(() => {\n      if (videoPlayer.value) {\n        videoPlayer.value.removeEventListener('play', handleVideoPlay);\n      }\n    });\n    const __returned__ = {\n      videoData,\n      videoPlayer,\n      numberOfEpisodes,\n      videoCanvas,\n      get canvasContext() {\n        return canvasContext;\n      },\n      set canvasContext(v) {\n        canvasContext = v;\n      },\n      route,\n      videoId,\n      videoName,\n      loadVideoData,\n      loadNumberOfEpisodes,\n      initializeCanvas,\n      loadEpisode,\n      handleVideoLoaded,\n      renderVideoFrameToCanvas,\n      applyBlurEffect,\n      handleVideoPlay,\n      ref,\n      onMounted,\n      onUnmounted,\n      get request() {\n        return request;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","request","useRoute","videoData","videoPlayer","numberOfEpisodes","videoCanvas","canvasContext","route","videoId","params","id","videoName","name","loadVideoData","res","get","value","data","error","console","loadNumberOfEpisodes","setTimeout","initializeCanvas","document","querySelector","log","getContext","loadEpisode","episodeNumber","url","src","load","handleVideoLoaded","play","renderVideoFrameToCanvas","paused","ended","clearRect","width","height","drawImage","applyBlurEffect","filter","handleVideoPlay","requestAnimationFrame","addEventListener","removeEventListener"],"sources":["F:/video/vue_video/src/views/VideoDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\"  v-if=\"videoData\">\r\n    <div class=\"video-wrapper\">\r\n      <div class=\"video-container\">\r\n        <video ref=\"videoPlayer\" controls class=\"custom-video\" @canplaythrough=\"handleVideoLoaded\">\r\n          <source :src=\"videoData.url\" type=\"video/mp4\">\r\n          Your browser does not support the video tag.\r\n        </video>\r\n        <canvas ref=\"videoCanvas\" class=\"video-canvas\"></canvas>\r\n      </div>\r\n      <div class=\"button-container\">\r\n        <button v-for=\"(episode, index) in numberOfEpisodes\" :key=\"index\" @click=\"loadEpisode(index + 1)\">\r\n          Episode {{ index + 1 }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div v-else>\r\n    Loading...\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted } from 'vue';\r\nimport request from \"@/utils/request\";\r\nimport { useRoute } from 'vue-router';\r\n\r\nconst videoData = ref(null);\r\nconst videoPlayer = ref(null);\r\nconst numberOfEpisodes = ref(0);\r\nconst videoCanvas = ref(null);\r\nlet canvasContext = null;\r\n\r\nconst route = useRoute();\r\nconst videoId = route.params.id;\r\nconst videoName = route.params.name;\r\n\r\nconst loadVideoData = async () => {\r\n  try {\r\n    const res = await request.get(`/file/${videoId}`);\r\n    videoData.value = res.data.data;\r\n  } catch (error) {\r\n    console.error('Error loading video data:', error);\r\n  }\r\n};\r\n\r\nconst loadNumberOfEpisodes = async () => {\r\n  try {\r\n    const res = await request.get('/videos/diversity', { params: { name: videoName } });\r\n    numberOfEpisodes.value = res.data.data;\r\n  } catch (error) {\r\n    console.error('Error loading number of episodes:', error);\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  loadVideoData();\r\n  loadNumberOfEpisodes();\r\n  setTimeout(initializeCanvas, 0); // 延迟执行 initializeCanvas 方法\r\n});\r\n\r\nconst initializeCanvas = () => {\r\n  videoCanvas.value = ref(document.querySelector('.video-canvas')); // 使用 ref 函数获取元素引用\r\n  console.log(\"videoCanvas.value\",videoCanvas.value)\r\n  if (!videoCanvas.value.value) return; // 检查是否获取到了 canvas 元素\r\n  canvasContext = videoCanvas.value.value.getContext('2d'); // 使用 .value 来访问引用的值\r\n};\r\n\r\nconst loadEpisode = async (episodeNumber) => {\r\n  try {\r\n    const res = await request.get(`/videos/${videoName}/episode/${episodeNumber}`);\r\n    const url = res.data.data;\r\n    if (videoPlayer.value) {\r\n      videoPlayer.value.src = url;\r\n      videoPlayer.value.load();\r\n    }\r\n  } catch (error) {\r\n    console.error('Error loading episode:', error);\r\n  }\r\n};\r\n\r\nconst handleVideoLoaded = () => {\r\n  if (videoPlayer.value) {\r\n    videoPlayer.value.play();\r\n  }\r\n};\r\n\r\nconst renderVideoFrameToCanvas = () => {\r\n  if (!videoPlayer.value || !canvasContext || videoPlayer.value.paused || videoPlayer.value.ended) return; // 添加条件以避免错误\r\n  canvasContext.clearRect(0, 0, videoCanvas.value.width, videoCanvas.value.height); // 清除画布\r\n\r\n  console.log(\"videoCanvas.value.width====\",videoCanvas.value.width)\r\n  canvasContext.drawImage(videoPlayer.value, 0, 0, videoCanvas.value.width, videoCanvas.value.height);\r\n  applyBlurEffect();\r\n};\r\n\r\nconst applyBlurEffect = () => {\r\n  if (!canvasContext) return; // 提前返回以避免错误\r\n  canvasContext.filter = 'blur(10px)'; // 应用模糊效果\r\n};\r\n\r\n// 监听视频播放事件，确保在视频播放时渲染视频帧到 Canvas\r\nconst handleVideoPlay = () => {\r\n  requestAnimationFrame(renderVideoFrameToCanvas); // 使用 requestAnimationFrame 代替 setInterval，以优化性能\r\n};\r\n\r\n// 监听视频播放事件\r\nonMounted(() => {\r\n  if (videoPlayer.value) {\r\n    videoPlayer.value.addEventListener('play', handleVideoPlay);\r\n  }\r\n});\r\n\r\n// 在组件销毁时移除事件监听器\r\nonUnmounted(() => {\r\n  if (videoPlayer.value) {\r\n    videoPlayer.value.removeEventListener('play', handleVideoPlay);\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  border: 2px solid #ccc;\r\n  padding: 10px;\r\n  background-color: white;\r\n}\r\n\r\n.video-wrapper {\r\n  display: flex;\r\n}\r\n\r\n.video-container {\r\n  position: relative;\r\n}\r\n\r\n.custom-video {\r\n  width: 1200px;\r\n  height: 800px;\r\n}\r\n\r\n.video-canvas {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: -1;\r\n}\r\n\r\n.button-container {\r\n  margin-left: 20px;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.button-container button {\r\n  margin-bottom: 10px;\r\n}\r\n.video-canvas {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: -1;\r\n  width: 1200px; /* 与视频容器相同的宽度 */\r\n  height: 800px; /* 与视频容器相同的高度 */\r\n}\r\n</style>\r\n"],"mappings":"AAuBA,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAK;AACjD,OAAOC,OAAO,MAAM,iBAAiB;AACrC,SAASC,QAAQ,QAAQ,YAAY;;;;;;;IAErC,MAAMC,SAAS,GAAGL,GAAG,CAAC,IAAI,CAAC;IAC3B,MAAMM,WAAW,GAAGN,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMO,gBAAgB,GAAGP,GAAG,CAAC,CAAC,CAAC;IAC/B,MAAMQ,WAAW,GAAGR,GAAG,CAAC,IAAI,CAAC;IAC7B,IAAIS,aAAa,GAAG,IAAI;IAExB,MAAMC,KAAK,GAAGN,QAAQ,CAAC,CAAC;IACxB,MAAMO,OAAO,GAAGD,KAAK,CAACE,MAAM,CAACC,EAAE;IAC/B,MAAMC,SAAS,GAAGJ,KAAK,CAACE,MAAM,CAACG,IAAI;IAEnC,MAAMC,aAAa,GAAG,MAAAA,CAAA,KAAY;MAChC,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMd,OAAO,CAACe,GAAG,CAAE,SAAQP,OAAQ,EAAC,CAAC;QACjDN,SAAS,CAACc,KAAK,GAAGF,GAAG,CAACG,IAAI,CAACA,IAAI;MACjC,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACnD;IACF,CAAC;IAED,MAAME,oBAAoB,GAAG,MAAAA,CAAA,KAAY;MACvC,IAAI;QACF,MAAMN,GAAG,GAAG,MAAMd,OAAO,CAACe,GAAG,CAAC,mBAAmB,EAAE;UAAEN,MAAM,EAAE;YAAEG,IAAI,EAAED;UAAU;QAAE,CAAC,CAAC;QACnFP,gBAAgB,CAACY,KAAK,GAAGF,GAAG,CAACG,IAAI,CAACA,IAAI;MACxC,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MAC3D;IACF,CAAC;IAEDpB,SAAS,CAAC,MAAM;MACde,aAAa,CAAC,CAAC;MACfO,oBAAoB,CAAC,CAAC;MACtBC,UAAU,CAACC,gBAAgB,EAAE,CAAC,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC;IAEF,MAAMA,gBAAgB,GAAGA,CAAA,KAAM;MAC7BjB,WAAW,CAACW,KAAK,GAAGnB,GAAG,CAAC0B,QAAQ,CAACC,aAAa,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;MAClEL,OAAO,CAACM,GAAG,CAAC,mBAAmB,EAACpB,WAAW,CAACW,KAAK,CAAC;MAClD,IAAI,CAACX,WAAW,CAACW,KAAK,CAACA,KAAK,EAAE,OAAO,CAAC;MACtCV,aAAa,GAAGD,WAAW,CAACW,KAAK,CAACA,KAAK,CAACU,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED,MAAMC,WAAW,GAAG,MAAOC,aAAa,IAAK;MAC3C,IAAI;QACF,MAAMd,GAAG,GAAG,MAAMd,OAAO,CAACe,GAAG,CAAE,WAAUJ,SAAU,YAAWiB,aAAc,EAAC,CAAC;QAC9E,MAAMC,GAAG,GAAGf,GAAG,CAACG,IAAI,CAACA,IAAI;QACzB,IAAId,WAAW,CAACa,KAAK,EAAE;UACrBb,WAAW,CAACa,KAAK,CAACc,GAAG,GAAGD,GAAG;UAC3B1B,WAAW,CAACa,KAAK,CAACe,IAAI,CAAC,CAAC;QAC1B;MACF,CAAC,CAAC,OAAOb,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAChD;IACF,CAAC;IAED,MAAMc,iBAAiB,GAAGA,CAAA,KAAM;MAC9B,IAAI7B,WAAW,CAACa,KAAK,EAAE;QACrBb,WAAW,CAACa,KAAK,CAACiB,IAAI,CAAC,CAAC;MAC1B;IACF,CAAC;IAED,MAAMC,wBAAwB,GAAGA,CAAA,KAAM;MACrC,IAAI,CAAC/B,WAAW,CAACa,KAAK,IAAI,CAACV,aAAa,IAAIH,WAAW,CAACa,KAAK,CAACmB,MAAM,IAAIhC,WAAW,CAACa,KAAK,CAACoB,KAAK,EAAE,OAAO,CAAC;MACzG9B,aAAa,CAAC+B,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEhC,WAAW,CAACW,KAAK,CAACsB,KAAK,EAAEjC,WAAW,CAACW,KAAK,CAACuB,MAAM,CAAC,CAAC,CAAC;;MAElFpB,OAAO,CAACM,GAAG,CAAC,6BAA6B,EAACpB,WAAW,CAACW,KAAK,CAACsB,KAAK,CAAC;MAClEhC,aAAa,CAACkC,SAAS,CAACrC,WAAW,CAACa,KAAK,EAAE,CAAC,EAAE,CAAC,EAAEX,WAAW,CAACW,KAAK,CAACsB,KAAK,EAAEjC,WAAW,CAACW,KAAK,CAACuB,MAAM,CAAC;MACnGE,eAAe,CAAC,CAAC;IACnB,CAAC;IAED,MAAMA,eAAe,GAAGA,CAAA,KAAM;MAC5B,IAAI,CAACnC,aAAa,EAAE,OAAO,CAAC;MAC5BA,aAAa,CAACoC,MAAM,GAAG,YAAY,CAAC,CAAC;IACvC,CAAC;;IAED;IACA,MAAMC,eAAe,GAAGA,CAAA,KAAM;MAC5BC,qBAAqB,CAACV,wBAAwB,CAAC,CAAC,CAAC;IACnD,CAAC;;IAED;IACApC,SAAS,CAAC,MAAM;MACd,IAAIK,WAAW,CAACa,KAAK,EAAE;QACrBb,WAAW,CAACa,KAAK,CAAC6B,gBAAgB,CAAC,MAAM,EAAEF,eAAe,CAAC;MAC7D;IACF,CAAC,CAAC;;IAEF;IACA5C,WAAW,CAAC,MAAM;MAChB,IAAII,WAAW,CAACa,KAAK,EAAE;QACrBb,WAAW,CAACa,KAAK,CAAC8B,mBAAmB,CAAC,MAAM,EAAEH,eAAe,CAAC;MAChE;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}